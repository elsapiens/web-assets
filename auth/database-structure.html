<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Database Structure</title>
<style>
  body { font-family: Arial, sans-serif; line-height: 1.6; padding: 2rem; background: #1a1a2e; color: #e0e0e0; max-width: 1200px; margin: 0 auto; }
  h1 { color: #e0e0e0; border-bottom: 2px solid #3498db; padding-bottom: 0.5rem; }
  h2 { color: #e0e0e0; margin-top: 2rem; background: #16213e; padding: 0.5rem 1rem; border-left: 4px solid #3498db; }
  h3 { color: #b0b0b0; margin-top: 2rem; }
  p { color: #888; margin-bottom: 1rem; }
  table { border-collapse: collapse; width: 100%; margin-bottom: 2rem; background: #16213e; box-shadow: 0 1px 3px rgba(0,0,0,0.3); }
  th, td { border: 1px solid #2a2a4a; padding: 10px 12px; text-align: left; }
  th { background-color: #1f1f3a; font-weight: 600; color: #e0e0e0; }
  tr:hover { background-color: #1f2940; }
  code { background: #2a3f5f; padding: 3px 8px; border-radius: 3px; font-size: 1em; color: #7dd3fc; font-weight: 500; }
  .parent { cursor: pointer; }
  .parent td:first-child code::before { content: '▼ '; color: #3498db; font-size: 0.8em; }
  .parent.closed td:first-child code::before { content: '▶ '; }
  .child { background-color: #1a2535; }
  .child td:first-child { padding-left: 2rem; }
  .child.hidden { display: none; }
  
  /* Tab styles */
  .tabs { display: flex; gap: 0; margin-top: 2rem; border-bottom: 2px solid #3498db; }
  .tab { padding: 12px 24px; cursor: pointer; background: #16213e; border: none; font-size: 1em; font-weight: 600; color: #888; border-radius: 8px 8px 0 0; margin-bottom: -2px; transition: all 0.2s; }
  .tab:hover { background: #1f2940; color: #e0e0e0; }
  .tab.active { background: #3498db; color: #fff; }
  .tab-content { display: none; padding-top: 1rem; }
  .tab-content.active { display: block; }
</style>
</head>
<body>

<h1>Database Structure</h1>

<div class="tabs">
  <button class="tab active" data-tab="mongodb">Accounts API (MongoDB)</button>
  <button class="tab" data-tab="postgresql">ElAuth (PostgreSQL)</button>
</div>

<div id="mongodb" class="tab-content active">
<h2>Accounts API Database (MongoDB)</h2>

<h3>person collection</h3>
<p>Stores personal details of each customer.</p>
<table>
  <thead><tr><th>Field</th><th>Type</th></tr></thead>
  <tbody>
    <tr><td><code>_id</code></td><td>ObjectId</td></tr>
    <tr><td><code>uuid</code></td><td>string (UUID v4)</td></tr>
    <tr><td><code>display_name</code></td><td>string</td></tr>
    <tr><td><code>photo</code></td><td>string</td></tr>
    <tr class="parent" data-group="person-name"><td><code>name</code></td><td>object</td></tr>
    <tr class="child" data-parent="person-name"><td><code>salutation</code></td><td>string</td></tr>
    <tr class="child" data-parent="person-name"><td><code>first_name</code></td><td>string</td></tr>
    <tr class="child" data-parent="person-name"><td><code>middle_name</code></td><td>string</td></tr>
    <tr class="child" data-parent="person-name"><td><code>last_name</code></td><td>string</td></tr>
    <tr class="parent" data-group="person-handles"><td><code>handles</code></td><td>array</td></tr>
    <tr class="child" data-parent="person-handles"><td><code>type</code></td><td>string</td></tr>
    <tr class="child" data-parent="person-handles"><td><code>value</code></td><td>string</td></tr>
    <tr class="child" data-parent="person-handles"><td><code>verified</code></td><td>boolean</td></tr>
    <tr class="child" data-parent="person-handles"><td><code>is_primary</code></td><td>boolean</td></tr>
    <tr class="child" data-parent="person-handles"><td><code>is_hidden</code></td><td>boolean</td></tr>
    <tr><td><code>status</code></td><td>"active" | "inactive" | "pending"</td></tr>
    <tr><td><code>date_of_birth</code></td><td>Date</td></tr>
    <tr><td><code>gender</code></td><td>string</td></tr>
    <tr><td><code>pet_name</code></td><td>string</td></tr>
    <tr><td><code>nationality</code></td><td>string</td></tr>
    <tr><td><code>marital_status</code></td><td>string</td></tr>
    <tr><td><code>place_of_birth</code></td><td>string</td></tr>
    <tr><td><code>preferred_language</code></td><td>string</td></tr>
    <tr><td><code>notes</code></td><td>string</td></tr>
    <tr><td><code>role_history</code></td><td>array</td></tr>
    <tr><td><code>tags</code></td><td>string[]</td></tr>
    <tr class="parent" data-group="person-identifiers"><td><code>official_identifiers</code></td><td>array</td></tr>
    <tr class="child" data-parent="person-identifiers"><td><code>type</code></td><td>string</td></tr>
    <tr class="child" data-parent="person-identifiers"><td><code>value</code></td><td>string</td></tr>
    <tr class="parent" data-group="person-workspace"><td><code>workspace_relationships</code></td><td>array</td></tr>
    <tr class="child" data-parent="person-workspace"><td><code>workspace_id</code></td><td>UUID</td></tr>
    <tr class="child" data-parent="person-workspace"><td><code>reseller_id</code></td><td>UUID</td></tr>
    <tr class="child" data-parent="person-workspace"><td><code>tag</code></td><td>string</td></tr>
    <tr><td><code>last_login</code></td><td>Date</td></tr>
    <tr><td><code>custom_data</code></td><td>object[]</td></tr>
    <tr><td><code>created_at</code></td><td>Date</td></tr>
    <tr><td><code>updated_at</code></td><td>Date</td></tr>
    <tr><td><code>deleted_at</code></td><td>Date</td></tr>
  </tbody>
</table>

<h3>entity collection</h3>
<p>Either an organization/shop or a personal entity.</p>
<table>
  <thead><tr><th>Field</th><th>Type</th></tr></thead>
  <tbody>
    <tr><td><code>_id</code></td><td>ObjectId</td></tr>
    <tr><td><code>uuid</code></td><td>string (UUID v4)</td></tr>
    <tr><td><code>entity_code</code></td><td>string</td></tr>
    <tr><td><code>name</code></td><td>string</td></tr>
    <tr><td><code>entity_type</code></td><td>"individual" | "org"</td></tr>
    <tr><td><code>trade_name</code></td><td>string</td></tr>
    <tr><td><code>website</code></td><td>string</td></tr>
    <tr><td><code>normalized_name</code></td><td>string</td></tr>
    <tr><td><code>country_code</code></td><td>string (ISO 3166-1 alpha-2)</td></tr>
    <tr class="parent" data-group="entity-biz-id"><td><code>business_identifiers</code></td><td>array</td></tr>
    <tr class="child" data-parent="entity-biz-id"><td><code>type</code></td><td>string</td></tr>
    <tr class="child" data-parent="entity-biz-id"><td><code>value</code></td><td>string</td></tr>
    <tr class="child" data-parent="entity-biz-id"><td><code>country_code</code></td><td>string</td></tr>
    <tr class="child" data-parent="entity-biz-id"><td><code>verified</code></td><td>boolean</td></tr>
    <tr class="parent" data-group="entity-handles"><td><code>contact_handles</code></td><td>array</td></tr>
    <tr class="child" data-parent="entity-handles"><td><code>type</code></td><td>string</td></tr>
    <tr class="child" data-parent="entity-handles"><td><code>value</code></td><td>string</td></tr>
    <tr class="child" data-parent="entity-handles"><td><code>label</code></td><td>string</td></tr>
    <tr class="child" data-parent="entity-handles"><td><code>is_primary</code></td><td>boolean</td></tr>
    <tr><td><code>contact_uuids</code></td><td>string[]</td></tr>
    <tr class="parent" data-group="entity-addresses"><td><code>addresses</code></td><td>array</td></tr>
    <tr class="child" data-parent="entity-addresses"><td><code>uuid</code></td><td>UUID</td></tr>
    <tr class="child" data-parent="entity-addresses"><td><code>label</code></td><td>string</td></tr>
    <tr class="child" data-parent="entity-addresses"><td><code>type</code></td><td>string</td></tr>
    <tr class="child" data-parent="entity-addresses"><td><code>line1</code></td><td>string</td></tr>
    <tr class="child" data-parent="entity-addresses"><td><code>line2</code></td><td>string</td></tr>
    <tr class="child" data-parent="entity-addresses"><td><code>city</code></td><td>string</td></tr>
    <tr class="child" data-parent="entity-addresses"><td><code>state</code></td><td>string</td></tr>
    <tr class="child" data-parent="entity-addresses"><td><code>state_code</code></td><td>string</td></tr>
    <tr class="child" data-parent="entity-addresses"><td><code>state_identifier</code></td><td>string</td></tr>
    <tr class="child" data-parent="entity-addresses"><td><code>postal_code</code></td><td>string</td></tr>
    <tr class="child" data-parent="entity-addresses"><td><code>country</code></td><td>string</td></tr>
    <tr class="child" data-parent="entity-addresses"><td><code>country_code</code></td><td>string</td></tr>
    <tr class="child" data-parent="entity-addresses"><td><code>gstin</code></td><td>string</td></tr>
    <tr class="child" data-parent="entity-addresses"><td><code>company_code</code></td><td>string</td></tr>
    <tr class="child" data-parent="entity-addresses"><td><code>is_primary</code></td><td>boolean</td></tr>
    <tr><td><code>tags</code></td><td>string[]</td></tr>
    <tr><td><code>status</code></td><td>"active" | "inactive" | "archived"</td></tr>
    <tr><td><code>is_test_account</code></td><td>boolean</td></tr>
    <tr><td><code>created_at</code></td><td>Date</td></tr>
    <tr><td><code>updated_at</code></td><td>Date</td></tr>
  </tbody>
</table>

<h3>memberships collection</h3>
<p>Maps entity with person. Defines relationships between entities and persons.</p>
<table>
  <thead><tr><th>Field</th><th>Type</th></tr></thead>
  <tbody>
    <tr><td><code>_id</code></td><td>ObjectId</td></tr>
    <tr><td><code>person_id</code></td><td>string (UUID)</td></tr>
    <tr><td><code>entity_id</code></td><td>string (UUID)</td></tr>
    <tr><td><code>role_in_entity</code></td><td>string</td></tr>
    <tr><td><code>status</code></td><td>"active" | "inactive" | "suspended"</td></tr>
    <tr><td><code>department</code></td><td>string</td></tr>
    <tr><td><code>reports_to</code></td><td>string (UUID)</td></tr>
    <tr><td><code>ownership_percentage</code></td><td>number (0-100)</td></tr>
    <tr><td><code>legal_authority</code></td><td>boolean</td></tr>
    <tr><td><code>joined_via</code></td><td>"invite" | "self" | "admin"</td></tr>
    <tr><td><code>ended_at</code></td><td>Date</td></tr>
    <tr><td><code>created_at</code></td><td>Date</td></tr>
    <tr><td><code>updated_at</code></td><td>Date</td></tr>
  </tbody>
</table>

<h3>workspace_person collection</h3>
<p>Stores a workspace's version of person data.</p>
<table>
  <thead><tr><th>Field</th><th>Type</th></tr></thead>
  <tbody>
    <tr><td><code>workspace_contact_id</code></td><td>ObjectId</td></tr>
    <tr><td><code>workspace_id</code></td><td>string (UUID)</td></tr>
    <tr><td><code>reseller_id</code></td><td>string (UUID)</td></tr>
    <tr class="parent" data-group="wp-data"><td><code>data</code></td><td>object</td></tr>
    <tr class="child" data-parent="wp-data"><td><code>name</code></td><td>string</td></tr>
    <tr class="child" data-parent="wp-data"><td><code>preferred_language</code></td><td>string</td></tr>
    <tr><td><code>entities</code></td><td>object</td></tr>
    <tr><td><code>created_at</code></td><td>Date</td></tr>
    <tr><td><code>updated_at</code></td><td>Date</td></tr>
  </tbody>
</table>

<h3>reseller collection</h3>
<p>Basic details about reseller.</p>
<table>
  <thead><tr><th>Field</th><th>Type</th></tr></thead>
  <tbody>
    <tr><td><code>_id</code></td><td>ObjectId</td></tr>
    <tr><td><code>short_id</code></td><td>string</td></tr>
    <tr><td><code>name</code></td><td>string</td></tr>
    <tr><td><code>is_ecosystem_owner</code></td><td>boolean</td></tr>
    <tr><td><code>commission_percentage</code></td><td>number</td></tr>
    <tr><td><code>has_custom_domain</code></td><td>boolean</td></tr>
    <tr><td><code>config_file</code></td><td>string</td></tr>
  </tbody>
</table>
</div>

<div id="postgresql" class="tab-content">
<h2>ElAuth Database (PostgreSQL)</h2>

<h3>auth_identifiers table</h3>
<p>User login identifiers.</p>
<table>
  <thead><tr><th>Column</th><th>Type</th></tr></thead>
  <tbody>
    <tr><td><code>identifier_id</code></td><td>UUID (PK)</td></tr>
    <tr><td><code>person_id</code></td><td>UUID</td></tr>
    <tr><td><code>reseller_id</code></td><td>UUID</td></tr>
    <tr><td><code>type</code></td><td>TEXT ("username" | "email" | "phone")</td></tr>
    <tr><td><code>value</code></td><td>TEXT</td></tr>
    <tr><td><code>last_login</code></td><td>TIMESTAMPTZ</td></tr>
    <tr><td><code>verified</code></td><td>BOOLEAN (default false)</td></tr>
    <tr><td><code>created_at</code></td><td>TIMESTAMPTZ</td></tr>
  </tbody>
</table>

<h3>auth_credentials table</h3>
<p>User passwords.</p>
<table>
  <thead><tr><th>Column</th><th>Type</th></tr></thead>
  <tbody>
    <tr><td><code>password_id</code></td><td>UUID (PK)</td></tr>
    <tr><td><code>person_id</code></td><td>UUID</td></tr>
    <tr><td><code>reseller_id</code></td><td>UUID</td></tr>
    <tr><td><code>password_hash</code></td><td>TEXT</td></tr>
    <tr><td><code>password_changed_at</code></td><td>TIMESTAMPTZ</td></tr>
    <tr><td><code>created_at</code></td><td>TIMESTAMPTZ</td></tr>
    <tr><td><code>updated_at</code></td><td>TIMESTAMPTZ</td></tr>
  </tbody>
</table>

<h3>auth_password_history table</h3>
<p>Password change history.</p>
<table>
  <thead><tr><th>Column</th><th>Type</th></tr></thead>
  <tbody>
    <tr><td><code>history_id</code></td><td>UUID (PK)</td></tr>
    <tr><td><code>person_id</code></td><td>UUID</td></tr>
    <tr><td><code>reseller_id</code></td><td>UUID</td></tr>
    <tr><td><code>password_hash</code></td><td>TEXT</td></tr>
    <tr><td><code>changed_at</code></td><td>TIMESTAMPTZ</td></tr>
    <tr><td><code>change_reason</code></td><td>TEXT</td></tr>
  </tbody>
</table>

<h3>auth_password_resets table</h3>
<p>OTP-based password reset flow.</p>
<table>
  <thead><tr><th>Column</th><th>Type</th></tr></thead>
  <tbody>
    <tr><td><code>reset_id</code></td><td>UUID (PK)</td></tr>
    <tr><td><code>person_id</code></td><td>UUID</td></tr>
    <tr><td><code>reseller_id</code></td><td>UUID</td></tr>
    <tr><td><code>identifier_type</code></td><td>TEXT</td></tr>
    <tr><td><code>identifier_value</code></td><td>TEXT</td></tr>
    <tr><td><code>otp_code_hash</code></td><td>TEXT</td></tr>
    <tr><td><code>otp_code_plain</code></td><td>TEXT</td></tr>
    <tr><td><code>expires_at</code></td><td>TIMESTAMPTZ</td></tr>
    <tr><td><code>consumed_at</code></td><td>TIMESTAMPTZ</td></tr>
    <tr><td><code>created_at</code></td><td>TIMESTAMPTZ</td></tr>
    <tr><td><code>attempt_count</code></td><td>INT (default 0)</td></tr>
  </tbody>
</table>

<h3>auth_handle_verifications table</h3>
<p>OTP-based handle (email/phone) verification.</p>
<table>
  <thead><tr><th>Column</th><th>Type</th></tr></thead>
  <tbody>
    <tr><td><code>verification_id</code></td><td>UUID (PK)</td></tr>
    <tr><td><code>person_id</code></td><td>UUID</td></tr>
    <tr><td><code>handle_type</code></td><td>TEXT ("email" | "phone")</td></tr>
    <tr><td><code>handle_value</code></td><td>TEXT</td></tr>
    <tr><td><code>otp_code_hash</code></td><td>TEXT</td></tr>
    <tr><td><code>otp_code_plain</code></td><td>TEXT</td></tr>
    <tr><td><code>expires_at</code></td><td>TIMESTAMPTZ</td></tr>
    <tr><td><code>consumed_at</code></td><td>TIMESTAMPTZ</td></tr>
    <tr><td><code>created_at</code></td><td>TIMESTAMPTZ</td></tr>
    <tr><td><code>attempt_count</code></td><td>INT (default 0)</td></tr>
    <tr><td><code>verification_reason</code></td><td>TEXT ("registration" | "update" | "verification")</td></tr>
  </tbody>
</table>

<h3>auth_magic_links table</h3>
<p>Token-based passwordless authentication.</p>
<table>
  <thead><tr><th>Column</th><th>Type</th></tr></thead>
  <tbody>
    <tr><td><code>magic_link_id</code></td><td>UUID (PK)</td></tr>
    <tr><td><code>person_id</code></td><td>UUID</td></tr>
    <tr><td><code>reseller_id</code></td><td>UUID</td></tr>
    <tr><td><code>handle_type</code></td><td>TEXT ("email" | "phone")</td></tr>
    <tr><td><code>handle_value</code></td><td>TEXT</td></tr>
    <tr><td><code>token</code></td><td>TEXT (unique)</td></tr>
    <tr><td><code>token_hash</code></td><td>TEXT</td></tr>
    <tr><td><code>expires_at</code></td><td>TIMESTAMPTZ</td></tr>
    <tr><td><code>consumed_at</code></td><td>TIMESTAMPTZ</td></tr>
    <tr><td><code>created_at</code></td><td>TIMESTAMPTZ</td></tr>
    <tr><td><code>verification_reason</code></td><td>TEXT</td></tr>
  </tbody>
</table>

<h3>auth_mfa_methods table</h3>
<p>Multi-factor authentication methods.</p>
<table>
  <thead><tr><th>Column</th><th>Type</th></tr></thead>
  <tbody>
    <tr><td><code>mfa_id</code></td><td>UUID (PK)</td></tr>
    <tr><td><code>person_id</code></td><td>UUID</td></tr>
    <tr><td><code>reseller_id</code></td><td>UUID</td></tr>
    <tr><td><code>type</code></td><td>TEXT</td></tr>
    <tr><td><code>secret</code></td><td>TEXT</td></tr>
    <tr><td><code>config</code></td><td>JSONB</td></tr>
    <tr><td><code>enabled</code></td><td>BOOLEAN (default false)</td></tr>
    <tr><td><code>created_at</code></td><td>TIMESTAMPTZ</td></tr>
    <tr><td><code>verified_at</code></td><td>TIMESTAMPTZ</td></tr>
  </tbody>
</table>

<h3>oauth_identities table</h3>
<p>Social login integrations.</p>
<table>
  <thead><tr><th>Column</th><th>Type</th></tr></thead>
  <tbody>
    <tr><td><code>oauth_id</code></td><td>UUID (PK)</td></tr>
    <tr><td><code>person_id</code></td><td>UUID</td></tr>
    <tr><td><code>reseller_id</code></td><td>UUID</td></tr>
    <tr><td><code>provider</code></td><td>TEXT</td></tr>
    <tr><td><code>provider_user_id</code></td><td>TEXT</td></tr>
    <tr><td><code>email</code></td><td>TEXT</td></tr>
    <tr><td><code>display_name</code></td><td>TEXT</td></tr>
    <tr><td><code>profile_data</code></td><td>JSONB</td></tr>
    <tr><td><code>is_primary</code></td><td>BOOLEAN</td></tr>
    <tr><td><code>last_login_at</code></td><td>TIMESTAMPTZ</td></tr>
    <tr><td><code>last_token_issued_at</code></td><td>TIMESTAMPTZ</td></tr>
    <tr><td><code>created_at</code></td><td>TIMESTAMPTZ</td></tr>
    <tr><td><code>deleted_at</code></td><td>TIMESTAMPTZ</td></tr>
  </tbody>
</table>

<h3>auth_refresh_tokens table</h3>
<p>JWT refresh token storage.</p>
<table>
  <thead><tr><th>Column</th><th>Type</th></tr></thead>
  <tbody>
    <tr><td><code>token_id</code></td><td>UUID (PK)</td></tr>
    <tr><td><code>token_hash</code></td><td>TEXT</td></tr>
    <tr><td><code>membership_id</code></td><td>UUID</td></tr>
    <tr><td><code>client_id</code></td><td>TEXT</td></tr>
    <tr><td><code>last_used_at</code></td><td>TIMESTAMPTZ</td></tr>
    <tr><td><code>created_at</code></td><td>TIMESTAMPTZ</td></tr>
    <tr><td><code>expires_at</code></td><td>TIMESTAMPTZ</td></tr>
    <tr><td><code>revoked_at</code></td><td>TIMESTAMPTZ</td></tr>
  </tbody>
</table>

<h3>workspaces table</h3>
<p>Workspace data.</p>
<table>
  <thead><tr><th>Column</th><th>Type</th></tr></thead>
  <tbody>
    <tr><td><code>workspace_id</code></td><td>UUID (PK)</td></tr>
    <tr><td><code>name</code></td><td>TEXT</td></tr>
    <tr><td><code>short_id</code></td><td>TEXT (unique)</td></tr>
    <tr><td><code>creator_person_id</code></td><td>UUID</td></tr>
    <tr><td><code>reseller_id</code></td><td>UUID</td></tr>
    <tr><td><code>status</code></td><td>TEXT ("active" | "inactive" | "suspended")</td></tr>
    <tr><td><code>created_at</code></td><td>TIMESTAMPTZ</td></tr>
    <tr><td><code>updated_at</code></td><td>TIMESTAMPTZ</td></tr>
    <tr><td><code>deleted_at</code></td><td>TIMESTAMPTZ</td></tr>
  </tbody>
</table>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Tab switching
  document.querySelectorAll('.tab').forEach(function(tab) {
    tab.addEventListener('click', function() {
      // Remove active from all tabs and contents
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      
      // Add active to clicked tab and corresponding content
      this.classList.add('active');
      document.getElementById(this.dataset.tab).classList.add('active');
    });
  });

  // Collapsible rows
  document.querySelectorAll('.parent').forEach(function(parent) {
    parent.addEventListener('click', function() {
      const group = this.dataset.group;
      const children = document.querySelectorAll('[data-parent="' + group + '"]');
      const isClosed = this.classList.contains('closed');
      
      this.classList.toggle('closed');
      children.forEach(function(child) {
        child.classList.toggle('hidden', !isClosed);
      });
    });
  });
});
</script>

</body>
</html>
